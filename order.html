<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Your vacation, tours and travel theme needs are all met at emprise." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>訂單資訊 | 快樂遊</title>
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="./assets/favicon.ico" />
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="./styles/plugins.css" />
    <!-- Main CSS -->
    <link rel="stylesheet" href="./styles/main.css" />
    <link rel="stylesheet" type="text/css" href="./styles/flexslider.css" media="all" />
    <script src="./js/jquery-2.1.1.min.js"></script>
  </head>

  <body class="rlr-body">
    <!-- Header -->
    <header>
      <nav id="navigation" class="navigation rlr-navigation default-nav fixed-top">
        <!-- Logo -->
        <div class="navigation-header">
          <div class="navigation-brand-text">
            <div class="rlr-logo rlr-logo__navbar-brand rlr-logo--default">
              <a href="./index.html">
                <img src="./assets/logo.png" alt="#" style="width: 70px" class="" />
              </a>
            </div>
          </div>
          <div class="navigation-button-toggler" style="display: none">
            <span class="rlr-sVGIcon"> <i class="rlr-icon-font rlr-icon-font--megamenu flaticon-menu"> </i> </span>
          </div>
        </div>
        <div class="navigation-body rlr-navigation__body container">
          <div class="navigation-body-header rlr-navigation__body-header">
            <div class="navigation-brand-text">
              <div class="rlr-logo rlr-logo__navbar-brand rlr-logo--default">
                <a href="./index.html">
                  <img src="./assets/logo.png" alt="#" style="height: 70px" class="" />
                </a>
              </div>
            </div>
            <span class="rlr-sVGIcon navigation-body-close-button"> <i class="rlr-icon-font rlr-icon-font--megamenu flaticon-close"> </i> </span>
          </div>
            <!-- User account dropdown -->
            <li class="navigation-item" style="display: none">
              <a class="navigation-link" href="#"> User <img class="ui right spaced avatar image" src="./assets/images/avatar.png" alt="account avatar" /> </a>
              <ul class="navigation-dropdown">
                <li class="navigation-dropdown-item">
                  <a class="navigation-dropdown-link" href="./my-account-pages--dashboard.html">我的檔案</a>
                </li>
                <li class="navigation-dropdown-item">
                  <a class="navigation-dropdown-link" href="./my-account-pages--order.html">我的訂單</a>
                </li>
                <li class="navigation-dropdown-item">
                  <hr class="dropdown-divider rlr-dropdown__divider" />
                </li>
                <li class="navigation-dropdown-item">
                  <a class="navigation-dropdown-link" href="./account-pages--login.html">登出</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <!-- Main Content -->
    <main id="rlr-main" class="rlr-main--fixed-top">
      <div class="rlr-section__content--md-top">
        <div class="rlr-section rlr-section__my">
          <section class="rlr-section">
            <div class="container-xxl">
              <div class="entry-content">
                <div class="woocommerce-info">
                  <div class="rlr-page-title">
                    <span class="rlr-page-title__icon"> <i class="rlr-icon-font flaticon-seen"> </i> </span>
                    <div>
                      <h2 class="type-h3 rlr-page-title__title">訂單資訊</h2>
                      <span class="rlr-page-title__desc">感謝您預訂，請於24小時內完成付款，付款完成方可保證行程預定</span>
                    </div>
                  </div>
                </div>
                <div class="rlr-content">
                  <div class="woocommerce">
                    <div class="woocommerce-order">
                      <div class="woocommerce-order__col-1">
                        <ul class="woocommerce-order-overview woocommerce-thankyou-order-details order_details">
                          <li class="woocommerce-order-overview__order order">
                            訂單編號:
                            <span id="orderId">  </span>
                          </li>
                          <li class="woocommerce-order-overview__date date">
                            訂單成立日期:
                            <span id="orderDate">  </span>
                          </li>
                          <li class="woocommerce-order-overview__total total">
                            訂單總金額:
                            <span class="woocommerce-Price-amount amount">
                              <bdi>
                                <span class="woocommerce-Price-currencySymbol"> $ </span>
                                <price id="totalPrice"></price>
                                <span class="woocommerce-order-overview__payment-method"> 匯款 </span>
                              </bdi>
                            </span>
                          </li>
                        </ul>
                        <div>
                          <div class="table">
                            <table class="rlr-data-table woocommerce-orders-table woocommerce-MyAccount-orders shop_table shop_table_responsive my_account_orders account-orders-table">
                              <thead class="rlr-data-table__header">
                                <tr class="rlr-data-table__header-row">
                                  <th class="woocommerce-orders-table__header woocommerce-orders-table__header-order-number">
                                    <span class="nobr"> 付款編號 </span>
                                  </th>
                                  <th class="woocommerce-orders-table__header woocommerce-orders-table__header-order-date">
                                    <span class="nobr"> 付款日期 </span>
                                  </th>
                                  <th class="woocommerce-orders-table__header woocommerce-orders-table__header-order-status">
                                    <span class="nobr"> 應付金額 </span>
                                  </th>
                                  <th class="woocommerce-orders-table__header woocommerce-orders-table__header-order-total">
                                    <span class="nobr"> 實收金額 </span>
                                  </th>
                                  <th class="woocommerce-orders-table__header woocommerce-orders-table__header-order-actions">
                                    <span class="nobr"> 付款狀態 </span>
                                  </th>
                                </tr>
                              </thead>
                              <tbody id="payments">
                                
                              </tbody>
                            </table>
                            <b>✳ 請注意：此行程由海外供應商提供優惠方案，不可更換及退票。</b>
                          </div>
                        </div>
                        <div class="woocommerce-customer-details">
                          <h2 class="woocommerce-column__title">訂購人資訊</h2>
                          <address>
                            <ul class="woocommerce-details__items">
                              <li class="woocommerce-details__item">
                                <span class="woocommerce-details__icon"><i class="rlr-icon-font flaticon-carbon-user"> </i></span>
                                <div>
                                  <p class="woocommerce-details__title">姓名</p>
                                  <span class="woocommerce-details__desc" id="orderName">  </span>
                                </div>
                              </li>
                              <li class="woocommerce-details__item">
                                <span class="woocommerce-details__icon"><i class="rlr-icon-font flaticon-carbon-location"> </i></span>
                                <div>
                                  <p class="woocommerce-details__title">地址</p>
                                  <span class="woocommerce-details__desc" id="orderAddress">  </span>
                                </div>
                              </li>
                              <li class="woocommerce-details__item">
                                <span class="woocommerce-details__icon"><i class="rlr-icon-font flaticon-telephone"> </i></span>
                                <div>
                                  <p class="woocommerce-details__title">電話</p>
                                  <span class="woocommerce-details__desc" id="orderPhone">  </span>
                                </div>
                              </li>
                              <li class="woocommerce-details__item">
                                <span class="woocommerce-details__icon"><i class="rlr-icon-font flaticon-email"> </i></span>
                                <div>
                                  <p class="woocommerce-details__title">Email</p>
                                  <span class="woocommerce-details__desc" id="orderMail">  </span>
                                </div>
                              </li>
                            </ul>
                          </address>
                        </div>
                      </div>
                      <div class="woocommerce-order-details">
                        <h2 class="woocommerce-order-details__title">購買項目</h2>
                        <table class="woocommerce-table woocommerce-table--order-details shop_table order_details">
                          <thead>
                            <tr>
                              <th class="woocommerce-table__product-name product-name">行程</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                <ul class="order-detail-card">
                                  <li class="order-detail-card__header">
                                    <div>
                                      <img class="order-detail-card__img" id="travelImg" src="./assets/images/card_items-photo.jpg" alt="..." />
                                    </div>
                                    <div>
                                      <p class="order-detail-card__title" id="travelTitle"></p>
                                      <p class="order-detail-card__date">
                                        <span> 出發日期 </span>
                                        <span id="travelDate"> 21/04/22 </span>
                                      </p>
                                    </div>
                                  </li>
                                  <li class="order-detail-card__item" id="travelCount"></li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="company_1">去程航班</li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="startDate_1">去程日期</li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="startAirport_1">去程出發機場</li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="endAirport_1">去程抵達機場</li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="company_2">回程航班</li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="startDate_2">回程日期</li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="startAirport_2">去回出發機場</li>
                                  <li class="order-detail-card__item hiddenInfo" style="display: none" id="endAirport_2">回程抵達機場</li>
                                  <li class="order-detail-card__footer">
                                    <a href="javascript: $('.hiddenInfo').show();$(this).parent().hide()">
                                      更多內容
                                      <span>
                                        <i class="rlr-icon-font flaticon-down-chevron"></i>
                                      </span>
                                    </a>
                                  </li>
                                </ul>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>
    <!-- Footer -->
    <footer class="rlr-footer rlr-section rlr-section__mt">
      <div class="container">
        <div class="rlr-footer__getintouch">
          <div class="rlr-footer__getintouch_col rlr-footer__getintouch__col--title">
            <h4>預遊網</h4>
            <p>滿足你對旅行的想像</p>
          </div>
          
        </div>
        <!-- Footer menu -->
        <div class="rlr-footer__menu">
          
          <nav class="rlr-footer__menu__col">
            <!-- Footer menu col -->
            <h4>友善連結</h4>
            <ul>
              <li><a href="https://www.liontravel.com/">雄獅旅遊</a></li>
              <li><a href="https://www.colatour.com.tw/">可樂旅遊</a></li>
              <li><a href="https://www.kkday.com/">KKday</a></li>
              <li><a href="https://travel.yahoo.com.tw/">Yahoo!旅遊</a></li>
              <li><a href="https://www.settour.com.tw/">東南旅遊</a></li>
              <li><a href="https://www.startravel.com.tw/">燦星旅遊</a></li>
            </ul>
          </nav>
          <!-- Subscribe -->
          <nav class="rlr-footer__menu__col rlr-footer__menu__col--lg">
            <h4>合作洽詢</h4>
            <a href="#" class="rlr-footer__menu__col__letstalk">行程推廣敬請洽詢</a>
            <form class="rlr-subscribe" data-aos="fade-up" data-aos-offset="250" data-aos-duration="700">
              <input type="email" class="rlr-subscribe__input" placeholder="請輸入貴公司合作E-Mail" />
              <button class="btn">立即洽詢</button>
            </form>
          </nav>
        </div>
        <!-- Footer bottom -->
        <div class="rlr-footer__legal">
          <div class="rlr-footer__legal__row rlr-footer__legal__row--top">
            <div class="rlr-footer__legal__row__col">
              <a href="#">隱私權宣告</a>
            </div>
            
          </div>
          <!-- Footer copyright -->
          <div class="rlr-footer__legal__row rlr-footer__legal__row--bottom">
            <div class="rlr-footer__legal__row__col">
              <span>2022 © 預遊網 / 快樂遊國際有限公司</span>
            </div>
            <!-- Footer payment thumbs -->
            <div class="rlr-footer__legal__row__col">
              <img src="./assets/images/ele-payments.png" alt="Payments" />
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Scripts -->
    <script src="./vendors/navx/js/navigation.min.js" defer></script>
    <script src="./js/main.js" defer></script>
    <script>
      let search = location.search.substring(1);
      let req = JSON.parse('{"' + decodeURI(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g,'":"') + '"}');
      let orderId = req.orderId;
      let details = {};
      $("#orderId").text(orderId);
      $.getJSON("https://api.travelhappy.shop/order/" + orderId + ".json", function(json) {
        console.log(json);
        details = json;
        $("#orderDate").text(json.order_date);
        $("#totalPrice").text(json.totalPrice);
        $("#orderName").text(json.customer.name);
        $("#orderPhone").text(json.customer.phone);
        $("#orderMail").text(json.customer.email);
        $("#orderAddress").text(json.customer.address);

        $("#travelTitle").text(json.product.title);
        $("#travelCount").text(json.people + "人");
        $("#travelImg").attr("src", "https://api.travelhappy.shop/img/" + json.product.img);
        $("#travelDate").text(json.flight.startDate_1 + " 至 " + json.flight.startDate_2);

        $("#company_1").html("<b>去程航班: </b>" + json.flight.company_1 + " " + json.flight.plane_1);
        $("#startDate_1").html("<b>去程日期: </b>" + json.flight.startDate_1 + " " + json.flight.startTime_1);
        $("#startAirport_1").html("<b>去程出發機場: </b>" + json.flight.startAirport_1);
        $("#endAirport_1").html("<b>去程抵達機場: </b>" + json.flight.endAirport_1);
        $("#company_2").html("<b>回程航班: </b>" + json.flight.company_2 + " " + json.flight.plane_2);
        $("#startDate_2").html("<b>回程日期: </b>" + json.flight.startDate_2 + " " + json.flight.startTime_2);
        $("#startAirport_2").html("<b>回程出發機場: </b>" + json.flight.startAirport_2);
        $("#endAirport_2").html("<b>回程抵達機場: </b>" + json.flight.endAirport_2);

        let payments = json.payment;
        for(let pp of payments) {
          addPayment(pp);
        }
      });

      function addPayment(payment) {
        const formatter = new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD'
        });
        let amount = formatter.format(payment.amount).replaceAll("$", "").replaceAll(".00", "");
        let content = '<tr class="rlr-data-table__row woocommerce-orders-table__row woocommerce-orders-table__row--status-on-hold order">';
          content += '<td class="rlr-data-table__cell woocommerce-orders-table__cell woocommerce-orders-table__cell-order-number" data-title="Order">';
            content += '<a href="./product-detail-page.html"> ' + payment.payment_id + ' </a>';
            content += '</td>';
            content += '<td class="rlr-data-table__cell woocommerce-orders-table__cell woocommerce-orders-table__cell-order-date" data-title="Date">';
              content += '<time datetime="2022-04-20T08:01:42+00:00"> April 20, 2022 </time>';
              content += '</td>';
              
              content += '<td class="rlr-data-table__cell woocommerce-orders-table__cell woocommerce-orders-table__cell-order-status" data-title="Status"><b>TWD ' + amount + '</b></td>';
              content += '<td class="rlr-data-table__cell rlr-data-table__cell-total woocommerce-orders-table__cell woocommerce-orders-table__cell-order-total" data-title="Total">';
                content += '<span class="rlr-data-table__amount woocommerce-Price-amount amount">';
                  content += '<span class="woocommerce-Price-currencySymbol"> TWD </span>';
                  content += payment.paied;
                  content += '</span>';
                  content += '</td>';
                  content += '<td class="rlr-data-table__cell woocommerce-orders-table__cell woocommerce-orders-table__cell-order-actions" data-title="Actions">';
                    if(payment.paied == 0) {
                      content += '<button onclick="payPage(\'' + payment.payment_id + '\', \'' + payment.amount + '\')" >付款</button>';
                    } else if(payment.paied < payment.amount) {
                      content += '<b>未完整支付，請洽客服人員</b>';
                    } else if(payment.paied >= payment.amount) {
                      content += '<b>完成</b>';
                    }
                    content += '</td>';
                    content += '</tr>';
          $("#payments").append(content);
      }

      function payPage(paymentId, amount) {
        let baseUrl = "https://ssl.smse.com.tw/ezpos/mtmk_utf.asp";
        let customer = details.customer.name;
        let tel = details.customer.phone;
        let mob = details.customer.phone;
        let email = details.customer.email;
        let phone = details.customer.phone;
        let address = details.customer.address;
        let id = details.customer.id;
        let invoiceName = "";
        let invoiceNum = "";
        let remark = "";
        let roturl = "https://api.travelhappy.shop/roturl";
        let url = baseUrl + "?Rvg2c=1&Dcvc=14772&Od_sob=" + paymentId + "&Amount=" + amount + "&Pur_name=" + customer + "&Tel_number=" + tel + "&Mobile_number=" + mob + "&Address=" + address + "&Email=" + email + "&Invoice_name=" + invoiceName + "&Invoice_num=" + invoiceNum + "&Remark=" + remark + "&Roturl=" + roturl + "&Pay_zg=2";
        window.open(url);
      }
    </script>
  </body>
</html>
